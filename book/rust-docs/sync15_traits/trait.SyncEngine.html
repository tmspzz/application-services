<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="A “sync engine” is a thing that knows how to sync. It’s often implemented by a “store” (which is the generic term responsible for all storage associated with a component, including storage required for sync.)"><meta name="keywords" content="rust, rustlang, rust-lang, SyncEngine"><title>SyncEngine in sync15_traits - Rust</title><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../ayu.css" disabled ><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../favicon.svg"><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../down-arrow.svg");}</style></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../sync15_traits/index.html'><div class='logo-container rust-logo'><img src='../rust-logo.png' alt='logo'></div></a><h2 class="location">Trait SyncEngine</h2><div class="sidebar-elems"><div class="block items"><h3 class="sidebar-title"><a href="#required-methods">Required Methods</a></h3><div class="sidebar-links"><a href="#tymethod.apply_incoming">apply_incoming</a><a href="#tymethod.collection_name">collection_name</a><a href="#tymethod.get_collection_requests">get_collection_requests</a><a href="#tymethod.get_sync_assoc">get_sync_assoc</a><a href="#tymethod.reset">reset</a><a href="#tymethod.sync_finished">sync_finished</a><a href="#tymethod.wipe">wipe</a></div><h3 class="sidebar-title"><a href="#provided-methods">Provided Methods</a></h3><div class="sidebar-links"><a href="#method.prepare_for_sync">prepare_for_sync</a><a href="#method.set_local_encryption_key">set_local_encryption_key</a></div><h3 class="sidebar-title"><a href="#implementors">Implementors</a></h3></div><h2 class="location">Other items in<br><a href="index.html">sync15_traits</a></h2><div id="sidebar-vars" data-name="SyncEngine" data-ty="trait" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input"name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Trait <a href="index.html">sync15_traits</a>::<wbr><a class="trait" href="#">SyncEngine</a><button id="copy-path" onclick="copy_path(this)" title="copy path"><img src="../clipboard.svg" width="19" height="18" alt="Copy item import" title="Copy item import to clipboard"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../src/sync15_traits/engine.rs.html#40-137" title="goto source code">[src]</a></span></h1><div class="docblock type-decl"><pre class="rust trait">pub trait SyncEngine {
    fn <a href="#tymethod.collection_name" class="fnname">collection_name</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.55.0/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow">Cow</a>&lt;'static, <a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.str.html">str</a>&gt;;
<div class="item-spacer"></div>    fn <a href="#tymethod.apply_incoming" class="fnname">apply_incoming</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;inbound: <a class="struct" href="https://doc.rust-lang.org/1.55.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="type" href="type.IncomingChangeset.html" title="type sync15_traits::IncomingChangeset">IncomingChangeset</a>&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;telem: &amp;mut <a class="struct" href="telemetry/struct.Engine.html" title="struct sync15_traits::telemetry::Engine">Engine</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="type" href="type.OutgoingChangeset.html" title="type sync15_traits::OutgoingChangeset">OutgoingChangeset</a>&gt;;
<div class="item-spacer"></div>    fn <a href="#tymethod.sync_finished" class="fnname">sync_finished</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;new_timestamp: <a class="struct" href="struct.ServerTimestamp.html" title="struct sync15_traits::ServerTimestamp">ServerTimestamp</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;records_synced: <a class="struct" href="https://doc.rust-lang.org/1.55.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="struct.Guid.html" title="struct sync15_traits::Guid">Guid</a>&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.unit.html">()</a>&gt;;
<div class="item-spacer"></div>    fn <a href="#tymethod.get_collection_requests" class="fnname">get_collection_requests</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;server_timestamp: <a class="struct" href="struct.ServerTimestamp.html" title="struct sync15_traits::ServerTimestamp">ServerTimestamp</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.55.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="request/struct.CollectionRequest.html" title="struct sync15_traits::request::CollectionRequest">CollectionRequest</a>&gt;&gt;;
<div class="item-spacer"></div>    fn <a href="#tymethod.get_sync_assoc" class="fnname">get_sync_assoc</a>(&amp;self) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="enum" href="enum.EngineSyncAssociation.html" title="enum sync15_traits::EngineSyncAssociation">EngineSyncAssociation</a>&gt;;
<div class="item-spacer"></div>    fn <a href="#tymethod.reset" class="fnname">reset</a>(&amp;self, assoc: &amp;<a class="enum" href="enum.EngineSyncAssociation.html" title="enum sync15_traits::EngineSyncAssociation">EngineSyncAssociation</a>) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.unit.html">()</a>&gt;;
<div class="item-spacer"></div>    fn <a href="#tymethod.wipe" class="fnname">wipe</a>(&amp;self) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.unit.html">()</a>&gt;;

    fn <a href="#method.prepare_for_sync" class="fnname">prepare_for_sync</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_get_client_data: &amp;dyn <a class="trait" href="https://doc.rust-lang.org/1.55.0/core/ops/function/trait.Fn.html" title="trait core::ops::function::Fn">Fn</a>() -&gt; <a class="struct" href="client/struct.ClientData.html" title="struct sync15_traits::client::ClientData">ClientData</a><br>&nbsp;&nbsp;&nbsp;&nbsp;) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.unit.html">()</a>&gt; { ... }
<div class="item-spacer"></div>    fn <a href="#method.set_local_encryption_key" class="fnname">set_local_encryption_key</a>(&amp;mut self, _key: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.unit.html">()</a>&gt; { ... }
}</pre></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>A “sync engine” is a thing that knows how to sync. It’s often implemented
by a “store” (which is the generic term responsible for all storage
associated with a component, including storage required for sync.)</p>
<p>Low-level engine functionality. Engines that need custom reconciliation
logic should use this.</p>
<p>Different engines will produce errors of different types.  To accommodate
this, we force them all to return anyhow::Error.</p>
</div></details><h2 id="required-methods" class="small-section-header">Required methods<a href="#required-methods" class="anchor"></a></h2><div class="methods"><div id="tymethod.collection_name" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/sync15_traits/engine.rs.html#41" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.collection_name" class="fnname">collection_name</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.55.0/alloc/borrow/enum.Cow.html" title="enum alloc::borrow::Cow">Cow</a>&lt;'static, <a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.str.html">str</a>&gt;</h4></div><details class="rustdoc-toggle" open><summary><div id="tymethod.apply_incoming" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/sync15_traits/engine.rs.html#92-96" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.apply_incoming" class="fnname">apply_incoming</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;inbound: <a class="struct" href="https://doc.rust-lang.org/1.55.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="type" href="type.IncomingChangeset.html" title="type sync15_traits::IncomingChangeset">IncomingChangeset</a>&gt;, <br>&nbsp;&nbsp;&nbsp;&nbsp;telem: &amp;mut <a class="struct" href="telemetry/struct.Engine.html" title="struct sync15_traits::telemetry::Engine">Engine</a><br>) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="type" href="type.OutgoingChangeset.html" title="type sync15_traits::OutgoingChangeset">OutgoingChangeset</a>&gt;</h4></div></summary><div class="docblock"><p><code>inbound</code> is a vector to support the case where
<code>get_collection_requests</code> returned multiple requests. The changesets are
in the same order as the requests were – e.g. if <code>vec![req_a, req_b]</code>
was returned from <code>get_collection_requests</code>, <code>inbound</code> will have the
results from <code>req_a</code> as its first index, and those from <code>req_b</code> as it’s
second.</p>
</div></details><div id="tymethod.sync_finished" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/sync15_traits/engine.rs.html#98-102" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.sync_finished" class="fnname">sync_finished</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;new_timestamp: <a class="struct" href="struct.ServerTimestamp.html" title="struct sync15_traits::ServerTimestamp">ServerTimestamp</a>, <br>&nbsp;&nbsp;&nbsp;&nbsp;records_synced: <a class="struct" href="https://doc.rust-lang.org/1.55.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="struct.Guid.html" title="struct sync15_traits::Guid">Guid</a>&gt;<br>) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.unit.html">()</a>&gt;</h4></div><details class="rustdoc-toggle" open><summary><div id="tymethod.get_collection_requests" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/sync15_traits/engine.rs.html#122-125" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.get_collection_requests" class="fnname">get_collection_requests</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;server_timestamp: <a class="struct" href="struct.ServerTimestamp.html" title="struct sync15_traits::ServerTimestamp">ServerTimestamp</a><br>) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.55.0/alloc/vec/struct.Vec.html" title="struct alloc::vec::Vec">Vec</a>&lt;<a class="struct" href="request/struct.CollectionRequest.html" title="struct sync15_traits::request::CollectionRequest">CollectionRequest</a>&gt;&gt;</h4></div></summary><div class="docblock"><p>The engine is responsible for building the collection request. Engines
typically will store a lastModified timestamp and use that to build a
request saying “give me full records since that date” - however, other
engines might do something fancier. This could even later be extended to
handle “backfills” etc</p>
<p>To support more advanced use cases,  multiple requests can be returned
here - either from the same or different collections. The vast majority
of engines will just want to return zero or one item in their vector
(zero is a valid optimization when the server timestamp is the same as
the engine last saw, one when it is not)</p>
<p>Important: In the case when more than one collection is requested, it’s
assumed the last one is the “canonical” one. (That is, it must be for
“this” collection, its timestamp is used to represent the sync, etc).
(Note that multiple collection request support is currently unused, so
it might make sense to delete it - if we need it later, we may find a
better shape for our use-case)</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.get_sync_assoc" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/sync15_traits/engine.rs.html#129" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.get_sync_assoc" class="fnname">get_sync_assoc</a>(&amp;self) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="enum" href="enum.EngineSyncAssociation.html" title="enum sync15_traits::EngineSyncAssociation">EngineSyncAssociation</a>&gt;</h4></div></summary><div class="docblock"><p>Get persisted sync IDs. If they don’t match the global state we’ll be
<code>reset()</code> with the new IDs.</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="tymethod.reset" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/sync15_traits/engine.rs.html#134" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.reset" class="fnname">reset</a>(&amp;self, assoc: &amp;<a class="enum" href="enum.EngineSyncAssociation.html" title="enum sync15_traits::EngineSyncAssociation">EngineSyncAssociation</a>) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.unit.html">()</a>&gt;</h4></div></summary><div class="docblock"><p>Reset the engine (and associated store) without wiping local data,
ready for a “first sync”.
<code>assoc</code> defines how this store is to be associated with sync.</p>
</div></details><div id="tymethod.wipe" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/sync15_traits/engine.rs.html#136" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#tymethod.wipe" class="fnname">wipe</a>(&amp;self) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.unit.html">()</a>&gt;</h4></div></div><h2 id="provided-methods" class="small-section-header">Provided methods<a href="#provided-methods" class="anchor"></a></h2><div class="methods"><details class="rustdoc-toggle" open><summary><div id="method.prepare_for_sync" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/sync15_traits/engine.rs.html#56-58" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#method.prepare_for_sync" class="fnname">prepare_for_sync</a>(<br>&nbsp;&nbsp;&nbsp;&nbsp;&amp;self, <br>&nbsp;&nbsp;&nbsp;&nbsp;_get_client_data: &amp;dyn <a class="trait" href="https://doc.rust-lang.org/1.55.0/core/ops/function/trait.Fn.html" title="trait core::ops::function::Fn">Fn</a>() -&gt; <a class="struct" href="client/struct.ClientData.html" title="struct sync15_traits::client::ClientData">ClientData</a><br>) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.unit.html">()</a>&gt;</h4></div></summary><div class="docblock"><p>Prepares the engine for syncing. The tabs engine currently uses this to
store the current list of clients, which it uses to look up device names
and types.</p>
<p>Note that this method is only called by <code>sync_multiple</code>, and only if a
command processor is registered. In particular, <code>prepare_for_sync</code> will
not be called if the store is synced using <code>sync::synchronize</code> or
<code>sync_multiple::sync_multiple</code>. It <em>will</em> be called if the store is
synced via the Sync Manager.</p>
<p>TODO(issue #2590): This is pretty cludgey and will be hard to extend for
any case other than the tabs case. We should find another way to support
tabs…</p>
</div></details><details class="rustdoc-toggle" open><summary><div id="method.set_local_encryption_key" class="method has-srclink"><div class="rightside"><a class="srclink" href="../src/sync15_traits/engine.rs.html#82-84" title="goto source code">[src]</a></div><h4 class="code-header">fn <a href="#method.set_local_encryption_key" class="fnname">set_local_encryption_key</a>(&amp;mut self, _key: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.str.html">str</a>) -&gt; <a class="type" href="https://docs.rs/anyhow/1.0.44/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.55.0/std/primitive.unit.html">()</a>&gt;</h4></div></summary><div class="docblock"><p>Tells the engine what the local encryption key is for the data managed
by the engine. This is only used by collections that store data
encrypted locally and is unrelated to the encryption used by Sync.
The intent is that for such collections, this key can be used to
decrypt local data before it is re-encrypted by Sync and sent to the
storage servers, and similarly, data from the storage servers will be
decrypted by Sync, then encrypted by the local encryption key before
being added to the local database.</p>
<p>The expectation is that the key value is being maintained by the
embedding application in some secure way suitable for the environment
in which the app is running - eg, the OS “keychain”. The value of the
key is implementation dependent - it is expected that the engine and
embedding application already have some external agreement about how
to generate keys and in what form they are exchanged. Finally, there’s
an assumption that sync engines are short-lived and only live for a
single sync - this means that sync doesn’t hold on to the key for an
extended period.</p>
<p>This will panic if called by an engine that doesn’t have explicit
support for local encryption keys as that implies a degree of confusion
which shouldn’t be possible to ignore.</p>
</div></details></div><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor"></a></h2><div class="item-list" id="implementors-list"></div><script type="text/javascript" src="../implementors/sync15_traits/trait.SyncEngine.js" async></script></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../" data-current-crate="sync15_traits" data-search-index-js="../search-index.js" data-search-js="../search.js"></div>
    <script src="../main.js"></script>
</body></html>